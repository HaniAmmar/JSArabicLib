<!DOCTYPE html>
<html lang="ar" dir="rtl" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <title>أدوات للغة العربية</title>
</head>

<body>
    <div id="main">
        <fieldset class="options">
            <legend>الخيارات:</legend>
            <input type="radio" id="improveText" name="options" value="0" checked="checked" />
            <label for="improveText">تحسين النص.</label>
            <input type="radio" id="removeAllTashkil" name="options" value="1" />
            <label for="removeAllTashkil">إزالة كامل التشكيل.</label>
            <input type="radio" id="reduceTashkil" name="options" value="2" />
            <label for="reduceTashkil">تخفيف التشكيل.</label>
            <input type="radio" id="removeTashkilKeepShadda" name="options" value="3" />
            <label for="removeTashkilKeepShadda">إزالة التشكيل عدا الشدة.</label>
            <input type="radio" id="removeLastTashkil" name="options" value="4" />
            <label for="removeLastTashkil">إزالة تشكيل آخر حرف.</label>
            <input type="radio" id="keepLastTashkilOnly" name="options" value="5" />
            <label for="keepLastTashkilOnly">إبقاء تشكيل الحرف الأخير.</label>
            <input type="radio" id="removeTatweel" name="options" value="6" />
            <label for="removeTatweel">إزالة التطويل.</label>
            <input type="radio" id="encodeTashkil" name="options" value="8" />
            <label for="encodeTashkil">ترميز التشكيل.</label>
            <input type="radio" id="decodeTashkil" name="options" value="9" />
            <label for="decodeTashkil">دمج التشكيل.</label>
            <input type="radio" id="separateLamAlef" name="options" value="10" />
            <label for="separateLamAlef">فصل اللام عن الألف.</label>
            <input type="radio" id="unifyLetters" name="options" value="11" />
            <label for="unifyLetters">توحيد الحروف.</label>
            <input type="radio" id="simplifyText" name="options" value="12" />
            <label for="simplifyText">تبسيط النص.</label>
        </fieldset>

        <fieldset id="textFieldset">
            <legend>النص:</legend>
            <textarea rows="3" placeholder="اكتب نصًا هنا."
                id="inputText">   ذَهَـــبَ           زَيْــــدٌ إِلَى اَلـسُّوقِ فَلَمْ يَعْثُرْ عَلَى . . . . مَا كَانَ يُرِيدُ , وَكَانَ الْـجَوُّ حِينَهَا جَمِيلاً , وَ     الـسَّمَاءُ صَافِيَةً،والْهَوَاءُ نَقِيًا  ; فَذَهَبَ إِلَى اَلْبَحْرِ، وَجَلَسَ يَسْتَمْتِعُ بِالْغُرُوبِ عند مكان اسمه  : " الجُرْف " . </textarea>
            <button id="execute">تنفيذ</button>
            <button id="clearInputText">تفريغ الحقل</button>
        </fieldset>

        <fieldset id="resultFieldset">
            <legend>الناتج:</legend>
            <textarea id="resultText" rows="3"></textarea>
            <button id="copyResultText">نسخ</button>
        </fieldset>

        <fieldset id="tashkilFieldset">
            <legend>رموز التشكيل:</legend>
            <textarea id="tashkilText" rows="3" dir="ltr"></textarea>
        </fieldset>
    </div>

    <script type="module">
        import { ArBasic } from "./js/ArBasic.js";

        window.onload = function () {
            const ops = document.getElementsByName("options");
            const tashkilFieldset = document.getElementById("tashkilFieldset");
            let selectedOP = 0;

            function copyToClipboard(tag) {
                tag.select();
                document.execCommand("copy");
            }

            function clearText(tag) {
                tag.value = "";
            }

            function CheckTashkilFieldsetDisplay(selectedOP) {
                switch (selectedOP) {
                    case 8:
                    case 9:
                        tashkilFieldset.style.display = "block";
                        break;
                    default:
                        tashkilFieldset.style.display = "none";
                }
            }

            for (let i = 0; i < ops.length; i++) {
                const op = ops[i];

                op.addEventListener("change", function () {
                    selectedOP = parseInt(this.value, 10);
                    CheckTashkilFieldsetDisplay(selectedOP);
                });

                if (op.checked) {
                    selectedOP = parseInt(op.value, 10);
                    CheckTashkilFieldsetDisplay(selectedOP);
                }
            }

            const inputText = document.getElementById("inputText");
            const resultText = document.getElementById("resultText");
            const tashkilText = document.getElementById("tashkilText");

            document.getElementById("clearInputText").addEventListener("click", function () {
                clearText(inputText);
            });

            document.getElementById("copyResultText").addEventListener("click", function () {
                copyToClipboard(resultText);
            });

            document.getElementById("execute").addEventListener("click", function () {
                if (inputText.value.length === 0) {
                    return;
                }

                resultText.value = (function () {
                    switch (selectedOP) {
                        case 0:
                            return ArBasic.ImproveText(inputText.value);
                        case 1:
                        case 3:
                            return ArBasic.RemoveTashkil(inputText.value, (selectedOP === 3));
                        case 2:
                            return ArBasic.ReduceTashkil(inputText.value);
                        case 4:
                        case 5:
                            return ArBasic.LastTashkil(inputText.value, (selectedOP === 4));
                        case 6:
                            return ArBasic.RemoveTatweel(inputText.value);
                        case 8:
                            {
                                const ret = ArBasic.EncodeTashkil(inputText.value);
                                tashkilText.value = ret.EncodedTashkil;
                                return ret.StrippedText;
                            }
                        case 9:
                            return ArBasic.DecodeTashkil(inputText.resultText, tashkilText.value);
                        case 10:
                            return ArBasic.SeparateLamAlef(inputText.value);
                        case 11:
                            return ArBasic.UnifyLetters(inputText.value);
                        case 12:
                            return ArBasic.SimplifyText(inputText.value);
                        default:
                            return "";
                    }
                })();
            });
        };
    </script>
</body>

</html>
